### Chapter 12 - Indexes and Optimized Queries

## Introduction

There are a number of ways to optimize the queries that are generated by your Rails app. One way is to add indexes to the appropriate places. Another way to speed up your app is to optimize the queries that are auto-generated or hard-coded in your app.

## Indexes

As we discovered in chapters 8 and 9, adding indexes can significantly speed up the retrieval of data.

### Foreign Keys

When looking for ways to optimize our database, there are a number of places we can start. The first thing we should look for and add are indexes on all foreign keys.

Rails migrations by default add a primary key to a new table. PostgreSQL and MySQL automatically add indexes to these primary key fields. Foreign key indexes must be explicitly added to the database via a migration.

Joining tables is an expensive operation. Creating an index for a foreign key field allows the query optimizer to pull data from the index instead of having to perform a table scan, which is much faster.

### Partial Indexes

As the size of a table grows, creating specific indexes that are not only for a specific column, but an index that only contains a subset of the data can help make data retrieval more efficient because the index is smaller than the original table. Inserts and updates are also more efficient, because the partial index does not need to be updated every time a record is inserted or updated in the related table.

Partial indexes are indexes that have a WHERE clause. The WHERE clause is used to decide whether the index should be modified when a record is inserted, updated or deleted from the table. Regular indexes do not have a WHERE clause and are modifed for all changes on the table.

## Table Optimization

For databases that require regular maintenance, making sure that it's running lean is key to minimizing disk space usage and helping speed up queries that might need access tables directly.

## Inner joins vs left joins

## Common Table Expressions (CTE)

## Resources

* https://www.postgresql.org/docs/12/indexes-partial.html
* https://thoughtbot.com/blog/postgresql-performance-considerations

## Wrap-up
